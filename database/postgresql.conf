max_connections = 33
superuser_reserved_connections = 3
ssl = on

log_min_duration_statement = 1000  # Логировать запросы дольше 1 секунды
log_statement = 'none'             # Логировать только медленные запросы
log_format = 'csvlog'              # Чтобы можно было открыть с помощью pgBadger

shared_preload_libraries = 'pg_stat_statements, auto_explain'

pg_stat_statements.max = 10000           # Максимальное количество уникальных запросов
pg_stat_statements.track = all           # Отслеживать все типы команд
pg_stat_statements.track_utility = on    # Отслеживать утилитарные команды (например, EXPLAIN)
pg_stat_statements.save = on             # Сохранять статистику между перезагрузками

auto_explain.log_min_duration = '500ms'  # Логировать план выполнения запросов длительностью более 500 мс
auto_explain.log_analyze = on            # Включить анализ выполнения (ANALYZE) в объяснение
auto_explain.log_verbose = on            # Включить подробное объяснение
auto_explain.log_buffers = on            # Логировать использование буферов
auto_explain.log_format = text           # Формат логов (может быть также JSON)

logging_collector = on
log_directory = '/pg_log/'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_size = '10MB'
log_rotation_age = 0  # Ротация только по размеру
log_truncate_on_rotation = off
